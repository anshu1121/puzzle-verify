(function(e,l){typeof exports=="object"&&typeof module<"u"?module.exports=l(require("vue")):typeof define=="function"&&define.amd?define(["vue"],l):(e=typeof globalThis<"u"?globalThis:e||self,e["puzzle-verify"]=l(e.Vue))})(this,function(e){"use strict";const l=Math.PI,M=(t,n,a,f)=>{t.beginPath(),t.moveTo(n,a),t.arc(n+50/2,a-8+2,8,.72*l,2.26*l),t.lineTo(n+50,a),t.arc(n+50+8-2,a+50/2,8,1.21*l,2.78*l),t.lineTo(n+50,a+50),t.lineTo(n,a+50),t.arc(n+8-2,a+50/2,8+.4,2.76*l,1.24*l,!0),t.lineTo(n,a),t.lineWidth=0,t.fillStyle="rgba(255, 255, 255, .85)",t.strokeStyle="rgba(255, 255, 255, .8)",t.stroke(),t[f](),t.globalCompositeOperation="destination-over"},C=t=>(e.pushScopeId("data-v-713f0316"),t=t(),e.popScopeId(),t),z={key:0,class:"iconfont mask"},E=C(()=>e.createElementVNode("div",{class:"rotate"},"",-1)),R={class:"img-box"},I=["src"],D={class:"tip-text"},T={key:0,class:"light"},X={class:"iconfont arrow"},P={name:"PuzzleVerify"},A=e.defineComponent({...P,props:{imgSrc:{type:String},wrapper:{type:String},width:{type:Number,default:360},tip:{type:String,default:"拖动滑块完成验证"},successTip:{type:String,default:"验证成功"},showRefresh:{type:Boolean,default:!0},diffDistance:{type:Number,default:5},autoRefresh:{type:Boolean,default:!1}},emits:["success","fail","refresh"],setup(t,{expose:n,emit:a}){const f=t,c=e.ref(!1),u=e.ref(!1),W=e.computed(()=>({width:`${f.width}px`})),h=e.ref(),d=e.ref(),x=e.reactive({isOk:!1,isKeep:!1,clipBarx:0}),k=e.ref(),p=e.ref(),i=e.ref(!1),b=e.ref(),s=e.reactive({left:0,startX:0,isMoving:!1,imgX:0}),H=e.computed(()=>({left:`${e.unref(s.left)}px`})),L=r=>{i.value||(s.startX=r.x,s.isMoving=!0)},O=r=>{if(s.isMoving){const o=r.x-s.startX;s.left=o,d.value.style.left=o+"px",p.value.style.width=40+o+"px"}},B=r=>{if(r.type==="mouseup"&&(Math.abs(s.imgX-s.left)<f.diffDistance?(i.value=!0,a("success",{moveDistance:s.left,pointX:s.imgX})):(f.autoRefresh&&(c.value=!0),u.value=!0,a("fail",{moveDistance:s.left,pointX:s.imgX}))),r.type==="mouseup"&&f.autoRefresh){s.isMoving=!1;return}s.isMoving&&!i.value&&(e.unref(p).style.transition="width .5s",e.unref(b).style.transition="all .5s",e.unref(d).style.transition="left .5s",w()),s.isMoving=!1},$=()=>{c.value=!0,a("refresh")},w=()=>{u.value=!1,i.value=!1,s.left=0,s.startX=0,e.unref(d).style.left=0,e.unref(p)&&(e.unref(p).style.width=0),setTimeout(()=>{e.unref(b).style.transition="",e.unref(p).style.transition="",e.unref(d).style.transition=""},500)};n({reset:w});const j=()=>{w(),c.value=!1;const r=50,o=k.value.height,y=k.value.width,N=Math.floor(Number(f.width)/2),S=25,q=20,_=N+Math.floor(Math.random()*(N-r-S));let m=S+Math.floor(Math.random()*(o-r-S-q));h.value.setAttribute("width",y),h.value.setAttribute("height",o),h.value.style.display="block";const F=h.value.getContext("2d");M(F,_,m,"fill"),x.clipBarx=_,s.imgX=_;const g=d.value;g.setAttribute("width",y),g.setAttribute("height",o),g.style.display="block";const V=r+8*2+3,v=g.getContext("2d");v.clearRect(0,0,y,o),M(v,_,m,"clip"),v.drawImage(k.value,0,0,y,o),m=m-8*2-1;const K=v.getImageData(_,m,V,V);g.setAttribute("width",V),g.setAttribute("height",o),v.putImageData(K,0,m)};return(r,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["puzzle-verify",t.wrapper]),style:e.normalizeStyle(W.value)},[c.value?(e.openBlock(),e.createElementBlock("div",z,[E,e.createElementVNode("span",null,e.toDisplayString(u.value?"验证失败，请重试":"加载中"),1)])):e.createCommentVNode("",!0),e.createElementVNode("div",R,[t.showRefresh&&!i.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"iconfont refresh",onClick:o[0]||(o[0]=y=>$())},"")):e.createCommentVNode("",!0),e.createElementVNode("img",{src:t.imgSrc,ref_key:"imgRef",ref:k,onLoad:j},null,40,I),e.createElementVNode("canvas",{ref_key:"mainCanvasRef",ref:h,class:"main-canvas"},null,512),e.createElementVNode("canvas",{ref_key:"moveCanvasRef",ref:d,class:"move-canvas"},null,512)]),e.createElementVNode("div",{class:"drag-box",onMousemove:O,onMouseleave:B},[e.createElementVNode("div",D,[e.createTextVNode(e.toDisplayString(i.value?"":t.tip)+" ",1),i.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",T))]),e.createElementVNode("div",{class:e.normalizeClass(["progress-bar",{"progress-bar-passed":i.value,"progress-bar-fail":u.value}]),ref_key:"progressBarRef",ref:p},e.toDisplayString(i.value?t.successTip:""),3),e.createElementVNode("div",{class:"drag-bar",style:e.normalizeStyle(H.value),ref_key:"dragBarRef",ref:b,onMousedown:L,onMouseup:B},[e.createElementVNode("span",X,e.toDisplayString(i.value?"":""),1)],36)],32)],6))}}),G="";return((t,n)=>{const a=t.__vccOpts||t;for(const[f,c]of n)a[f]=c;return a})(A,[["__scopeId","data-v-713f0316"]])});
