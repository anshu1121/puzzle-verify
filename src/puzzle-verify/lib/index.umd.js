(function(e,l){typeof exports=="object"&&typeof module<"u"?module.exports=l(require("vue")):typeof define=="function"&&define.amd?define(["vue"],l):(e=typeof globalThis<"u"?globalThis:e||self,e["puzzle-verify"]=l(e.Vue))})(this,function(e){"use strict";const l=Math.PI,N=(t,r,a,c)=>{t.beginPath(),t.moveTo(r,a),t.arc(r+50/2,a-8+2,8,.72*l,2.26*l),t.lineTo(r+50,a),t.arc(r+50+8-2,a+50/2,8,1.21*l,2.78*l),t.lineTo(r+50,a+50),t.lineTo(r,a+50),t.arc(r+8-2,a+50/2,8+.4,2.76*l,1.24*l,!0),t.lineTo(r,a),t.lineWidth=0,t.fillStyle="rgba(255, 255, 255, .85)",t.strokeStyle="rgba(255, 255, 255, .8)",t.stroke(),t[c](),t.globalCompositeOperation="destination-over"},E=t=>(e.pushScopeId("data-v-ca601280"),t=t(),e.popScopeId(),t),R={key:0,class:"iconfont mask"},T=E(()=>e.createElementVNode("div",{class:"rotate"},"",-1)),I={class:"img-box"},X=["src"],D={class:"tip-text"},P={key:0,class:"light"},x={class:"iconfont arrow"},A={name:"PuzzleVerify"},W=e.defineComponent({...A,props:{imgSrc:{type:String},wrapper:{type:String},width:{type:Number,default:360},tip:{type:String,default:"拖动滑块完成验证"},successTip:{type:String,default:"验证成功"},showRefresh:{type:Boolean,default:!0},diffDistance:{type:Number,default:5},autoRefresh:{type:Boolean,default:!1}},emits:["success","fail","refresh"],setup(t,{expose:r,emit:a}){const c=t,d=e.ref(!1),y=e.ref(!1),H=e.computed(()=>({width:`${c.width}px`})),_=e.ref(),p=e.ref(),L=e.reactive({isOk:!1,isKeep:!1,clipBarx:0}),b=e.ref(),m=e.ref(),i=e.ref(!1),S=e.ref(),s=e.reactive({left:0,startX:0,isMoving:!1,imgX:0}),O=e.computed(()=>({left:`${e.unref(s.left)}px`})),C=n=>{const{type:o}=n,f=o==="mousedown"?n.x:n.touches[0].clientX;i.value||(s.startX=f,s.isMoving=!0)},z=n=>{if(s.isMoving){const{type:o}=n,u=(o==="mousemove"?n.x:n.touches[0].clientX)-s.startX;s.left=u,p.value.style.left=u+"px",m.value.style.width=40+u+"px"}},w=n=>{const{type:o}=n;if((o==="mouseup"||o==="touchend")&&(Math.abs(s.imgX-s.left)<c.diffDistance?(i.value=!0,a("success",{moveDistance:s.left,pointX:s.imgX})):(c.autoRefresh&&(d.value=!0),y.value=!0,a("fail",{moveDistance:s.left,pointX:s.imgX}))),(o==="mouseup"||o==="touchend")&&c.autoRefresh){s.isMoving=!1;return}s.isMoving&&!i.value&&(e.unref(m).style.transition="width .5s",e.unref(S).style.transition="all .5s",e.unref(p).style.transition="left .5s",V()),s.isMoving=!1},$=()=>{d.value=!0,a("refresh")},V=()=>{y.value=!1,i.value=!1,s.left=0,s.startX=0,e.unref(p).style.left=0,e.unref(m)&&(e.unref(m).style.width=0),setTimeout(()=>{e.unref(S).style.transition="",e.unref(m).style.transition="",e.unref(p).style.transition=""},500)};r({reset:V});const j=()=>{V(),d.value=!1;const n=50,o=b.value.height,f=b.value.width,u=Math.floor(Number(c.width)/2),M=25,q=20,v=u+Math.floor(Math.random()*(u-n-M));let h=M+Math.floor(Math.random()*(o-n-M-q));_.value.setAttribute("width",f),_.value.setAttribute("height",o),_.value.style.display="block";const F=_.value.getContext("2d");N(F,v,h,"fill"),L.clipBarx=v,s.imgX=v;const g=p.value;g.setAttribute("width",f),g.setAttribute("height",o),g.style.display="block";const B=n+8*2+3,k=g.getContext("2d");k.clearRect(0,0,f,o),N(k,v,h,"clip"),k.drawImage(b.value,0,0,f,o),h=h-8*2-1;const K=k.getImageData(v,h,B,B);g.setAttribute("width",B),g.setAttribute("height",o),k.putImageData(K,0,h)};return(n,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["puzzle-verify",t.wrapper]),style:e.normalizeStyle(H.value)},[d.value?(e.openBlock(),e.createElementBlock("div",R,[T,e.createElementVNode("span",null,e.toDisplayString(y.value?"验证失败，请重试":"加载中"),1)])):e.createCommentVNode("",!0),e.createElementVNode("div",I,[t.showRefresh&&!i.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"iconfont refresh",onClick:o[0]||(o[0]=f=>$())},"")):e.createCommentVNode("",!0),e.createElementVNode("img",{src:t.imgSrc,ref_key:"imgRef",ref:b,onLoad:j},null,40,X),e.createElementVNode("canvas",{ref_key:"mainCanvasRef",ref:_,class:"main-canvas"},null,512),e.createElementVNode("canvas",{ref_key:"moveCanvasRef",ref:p,class:"move-canvas"},null,512)]),e.createElementVNode("div",{class:"drag-box",onTouchmove:z,onTouchcancel:w,onMousemove:z,onMouseleave:w},[e.createElementVNode("div",D,[e.createTextVNode(e.toDisplayString(i.value?"":t.tip)+" ",1),i.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",P))]),e.createElementVNode("div",{class:e.normalizeClass(["progress-bar",{"progress-bar-passed":i.value,"progress-bar-fail":y.value}]),ref_key:"progressBarRef",ref:m},e.toDisplayString(i.value?t.successTip:""),3),e.createElementVNode("div",{class:"drag-bar",style:e.normalizeStyle(O.value),ref_key:"dragBarRef",ref:S,onTouchstart:C,onTouchend:w,onMousedown:C,onMouseup:w},[e.createElementVNode("span",x,e.toDisplayString(i.value?"":""),1)],36)],32)],6))}}),G="";return((t,r)=>{const a=t.__vccOpts||t;for(const[c,d]of r)a[c]=d;return a})(W,[["__scopeId","data-v-ca601280"]])});
